# Архітектурна документація проєкту AI Assistant Work

## Загальний опис проєкту

**AI Assistant Work** — це модульна система Slack-бота на Node.js, призначена для автоматизації обробки різноманітних алертів, звітів та повідомлень у корпоративному Slack-просторі. Система забезпечує інтелектуальну класифікацію повідомлень, автоматичне реагування, щоденне моніторинг критичних звітів та інтеграцію з зовнішніми AI-сервісами.

### Основні цілі проєкту:
- Автоматизація обробки Slack-повідомлень та алертів
- Централізоване управління різними типами звітів
- Швидке сповіщення відповідальних осіб про критичні події
- Інтеграція з AI-сервісами для обробки контенту
- Забезпечення надійності та масштабованості системи

---

## Структура проєкту

### Коренева папка (`/`)

**Призначення**: Головна директорія проєкту, що містить конфігураційні файли та точку входу в систему.

**Основні файли**:
- `server.js` — головний серверний файл, що ініціалізує Express-додаток та підключає всі модулі
- `package.json` — конфігурація залежностей та скриптів проєкту
- `package-lock.json` — детальна інформація про встановлені версії пакетів
- `.env` — конфігураційні змінні середовища (не комітиться в git)
- `ARCHITECTURE.md` — архітектурна документація проєкту

**Роль у системі**: Точка входу та конфігурація проєкту.

---

### Папка `modules/` 

**Призначення**: Центральна папка, що містить всі функціональні модулі системи. Організована за принципом розділення відповідальності та функціональних доменів.

**Роль у системі**: Модульна архітектура, що забезпечує гнучкість та легкість підтримки.

---

#### Підпапка `modules/slack/`

**Призначення**: Модулі для роботи зі Slack API та обробки різних типів повідомлень та алертів.

**Роль у системі**: Ядро функціональності Slack-бота, що забезпечує взаємодію з користувачами та автоматизацію процесів.

**Основні модулі**:

##### `slackClient.js`
- **Призначення**: Централізований клієнт для роботи зі Slack Web API
- **Функціональність**: Ініціалізація WebClient з токеном бота
- **Залежності**: `@slack/web-api`
- **Використання**: Імпортується всіма іншими модулями для виконання Slack API викликів

##### `slackHandler.js`
- **Призначення**: Головний роутер для обробки Slack-подій та команд
- **Функціональність**: 
  - URL verification для Slack Events API
  - Маршрутизація повідомлень до відповідних обробників
  - Централізована обробка всіх типів Slack-подій
  - Функція `getMyBotId()` для отримання ID бота
- **Залежності**: Всі модулі-обробники (`alertsHandler`, `wixezHandler`, `managerAlertsHandler`, `harixxReportHandler`, `proxiAlertHandler`)
- **Роль**: Центральний координатор всіх Slack-функцій

##### `alertsHandler.js`
- **Призначення**: Обробка загальних алертів з класифікацією за типами
- **Функціональність**:
  - Класифікація алертів на `critical`, `info_old_parser`, `repeating`
  - Автоматичне додавання реакцій
  - Ескалація повторюваних алертів
- **Залежності**: `slackClient`
- **Роль**: Універсальний обробник алертів для різних каналів

##### `wixezHandler.js`
- **Призначення**: Спеціалізований обробник для Wixez-алертів
- **Функціональність**:
  - Пошук фрази "Supplier Formula Deleted"
  - Додавання реакції `:exclamation:`
  - Сповіщення власника через тегування
- **Залежності**: `slackClient`
- **Роль**: Специфічна обробка Wixez-подій

##### `managerAlertsHandler.js`
- **Призначення**: Обробка менеджерських алертів з аналізом відсотків
- **Функціональність**:
  - Пошук звітів "ActToDayBfr"
  - Аналіз відсотків та виявлення критичних відхилень (≤ -3%)
  - Щоденна перевірка о 13:30-13:35
  - Автоматичне сповіщення про відсутність звітів
- **Залежності**: `slackClient`
- **Роль**: Складний аналіз звітів з часовими перевірками

##### `harixxReportHandler.js`
- **Призначення**: Обробка трьох типів щоденних звітів Harixx
- **Функціональність**:
  - **Summary Report**: аналіз TrPerc з порогом 7%, перевірка 10:00-10:03
  - **Report by Shop**: проста перевірка наявності, контроль 10:00-10:05
  - **Report for Business**: проста перевірка наявності, контроль 10:00-10:05
  - Автоматичне сповіщення про відсутні звіти
- **Залежності**: `slackClient`
- **Роль**: Комплексна обробка різних типів звітів з часовими обмеженнями

##### `proxiAlertHandler.js`
- **Призначення**: Обробка проксі-алертів
- **Функціональність**:
  - Пошук фрази "Failed Proxies Alert"
  - Тегування розробника та власників
  - Додавання реакції `:rotating_light:`
- **Залежності**: `slackClient`
- **Роль**: Специфічна обробка проксі-проблем

##### `reportChecker.js`
- **Призначення**: Щоденна перевірка звітів про склад
- **Функціональність**:
  - Перевірка о 12:30 щодня
  - Пошук "Warehouse Statistics" у повідомленнях
  - Автоматичне додавання реакцій або сповіщень
- **Залежності**: `slackClient`
- **Роль**: Автоматизований моніторинг складських звітів

---

#### Підпапка `modules/readAI/`

**Призначення**: Модуль для обробки webhook-ів від ReadAI та автоматичного створення зведень зустрічей у Slack.

**Роль у системі**: Інтеграція з ReadAI для автоматизації обробки транскриптів зустрічей.

**Основні модулі**:

##### `readAIHandler.js`
- **Призначення**: Express-роутер для обробки ReadAI webhook-ів
- **Функціональність**:
  - POST `/webhook` endpoint для отримання даних від ReadAI
  - Валідація `webhook_secret` для безпеки
  - GET `/health` endpoint для перевірки статусу
- **Залежності**: `readAIService`
- **Роль**: Безпечний прийом webhook-ів від ReadAI

##### `readAIService.js`
- **Призначення**: Логіка обробки даних зустрічей та створення Slack-повідомлень
- **Функціональність**:
  - Витягування `meeting_id`, `title`, `transcript_url`, `host_email`
  - Фільтрація зустрічей за email власника
  - Генерація dummy summary (готово для AI-інтеграції)
  - Відправка в `SLACK_SUMMARY_CHANNEL_ID`
- **Залежності**: `slackClient`
- **Роль**: Обробка та форматування даних зустрічей

---

#### Підпапка `modules/gemini/`

**Призначення**: Модуль для інтеграції з Google Gemini AI API для обробки контенту та генерації зведень.

**Роль у системі**: AI-функціональність для аналізу та обробки тексту.

**Основні модулі**:

##### `geminiClient.js`
- **Призначення**: Клієнт для роботи з Google Gemini API
- **Функціональність**: Ініціалізація та конфігурація Gemini клієнта
- **Залежності**: Google AI SDK
- **Роль**: Централізований доступ до Gemini API

##### `geminiService.js`
- **Призначення**: Сервіс для обробки запитів до Gemini AI
- **Функціональність**: 
  - Аналіз тексту та транскриптів
  - Генерація зведень та інсайтів
  - Обробка різних типів контенту
- **Залежності**: `geminiClient`
- **Роль**: AI-логіка для обробки контенту

---

#### Підпапка `modules/integration/`

**Призначення**: Модуль для інтеграції з зовнішніми системами та API.

**Роль у системі**: Централізована точка для зовнішніх інтеграцій.

**Поточний стан**: Порожня папка, готова для майбутніх інтеграцій.

---

#### Підпапка `modules/asana/`

**Призначення**: Модуль для інтеграції з Asana project management системою.

**Роль у системі**: Автоматизація управління проектами та завданнями.

**Поточний стан**: Порожня папка, готова для майбутньої Asana-інтеграції.

---

## Архітектурні принципи та взаємодії

### Модульна архітектура
Система побудована на принципі **розділення відповідальності**, де кожен модуль відповідає за конкретний тип функціональності. Це забезпечує:
- Легкість підтримки та розширення
- Незалежність модулів
- Чіткість інтерфейсів

### Патерн "Централізована маршрутизація"
`slackHandler.js` виступає як **центральний координатор** для Slack-функцій, а `server.js` як головний роутер для всіх модулів.

### Залежності та взаємодії

```
server.js (головний сервер)
    ↓
├── slackHandler (Slack-функції)
│   └── [всі Slack-модулі] → slackClient
├── readAIHandler (ReadAI webhook)
│   └── readAIService → slackClient
└── geminiService (AI-функції)
    └── geminiClient → Google AI API
```

**Ключові взаємодії**:
1. **server.js** ініціалізує всі модулі та запускає сервер
2. **slackHandler** обробляє всі Slack-події та делегує їх обробку
3. **readAIHandler** приймає webhook-и від ReadAI та обробляє їх
4. **geminiService** надає AI-функціональність для обробки контенту
5. **Всі модулі** використовують відповідні клієнти для API викликів

### Конфігурація та змінні середовища
Система використовує **централізовану конфігурацію** через змінні середовища:
- `SLACK_BOT_TOKEN` — токен бота для всіх API викликів
- `SLACK_*_CHANNEL_ID` — ID каналів для різних типів алертів
- `SLACK_*_USER_*_ID` — ID користувачів для тегування
- `READAI_WEBHOOK_SECRET` — секрет для валідації ReadAI webhook-ів
- `MY_EMAIL` — email для фільтрації зустрічей ReadAI
- `SLACK_SUMMARY_CHANNEL_ID` — канал для зведень зустрічей

---

## Переваги архітектури

### Масштабованість
- Легко додавати нові типи алертів через створення нових модулів
- Модульна структура дозволяє незалежно розвивати різні компоненти
- Готовність до додавання нових інтеграцій (Asana, інші AI-сервіси)

### Надійність
- Розділення відповідальності мінімізує ризик впливу однієї помилки на всю систему
- Централізована обробка помилок та логування
- Валідація webhook-ів для безпеки

### Підтримка
- Чітка структура файлів та модулів
- Стандартизовані інтерфейси між компонентами
- Детальне логування для діагностики

### Тестування
- Модульна структура спрощує unit-тестування
- Можливість тестувати кожен модуль незалежно

---

## Рекомендації по розвитку

### Короткострокові покращення
1. Додати централізовану обробку помилок
2. Реалізувати метрики та моніторинг продуктивності
3. Додати конфігураційні файли для різних середовищ
4. Інтегрувати Gemini AI з ReadAI для автоматичної генерації зведень

### Довгострокові покращення
1. Реалізувати систему плагінів для легкого додавання нових типів алертів
2. Додати веб-інтерфейс для конфігурації та моніторингу
3. Реалізувати систему черг для обробки великої кількості повідомлень
4. Розширити інтеграції з Asana та іншими системами управління проектами

---

## Поточний стан та готовність

### Готові модулі
- ✅ **Slack-функціональність** — повністю реалізована
- ✅ **ReadAI інтеграція** — готова до використання
- ✅ **Gemini AI інтеграція** — базова структура готова
- ✅ **Система алертів** — повністю функціональна

### Модулі в розробці
- 🔄 **Asana інтеграція** — структура готова, логіка не реалізована
- 🔄 **AI-обробка зведень** — dummy-логіка готова, AI-інтеграція планується

### Готовність до продакшену
Система готова до базового використання з усіма Slack-функціями та ReadAI інтеграцією. Для повної функціональності потрібно завершити AI-інтеграцію та додати Asana-функції.

---

Ця архітектура забезпечує надійну основу для подальшого розвитку та масштабування системи автоматизації Slack-бота з розширеними AI-можливостями та інтеграціями.



